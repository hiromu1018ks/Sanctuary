# SNSアプリ「Sanctuary」画面遷移図

**作成日:** 2025年7月10日  
**バージョン:** 1.1 (改善案反映版)
**作成者:** UI/UXデザイナー  

---

## 1. 概要

本文書は、SNSアプリ「Sanctuary」の画面遷移図を定義します。アプリのコンセプトである「心の安全地帯」を体現し、ユーザーがポジティブな体験を維持できるよう設計されています。

**関連ドキュメント:**
-   [要件定義書](./SNSアプリ「Sanctuary」要件定義書.md)
-   [開発ロードマップ](./SNSアプリ「Sanctuary」開発ロードマップ.md)

---

## 2. MVP (Phase 0) の画面遷移

個人開発のMVP段階では、機能を大幅に絞り込み、以下のシンプルな画面遷移となります。

```
アプリ起動
    ↓
ログイン画面 (Google認証)
    ↓ (認証成功)
タイムライン画面（ホーム）
    ├─→ 投稿作成画面
    │    ↓ (投稿成功)
    │    タイムライン画面へ戻る
    │
    ├─→ プロフィール画面
    │    └─→ タイムライン画面へ戻る
    │
    └─→ 設定画面 (ログアウト、退会のみ)
         └─→ ログイン画面へ戻る
```

---

## 3. フル機能版の画面遷移 (Phase 5以降)

### 3.1 画面分類

#### 3.1.1 認証・申請フロー（アプリ参加前）
- **申請フォーム画面**
- **申請完了・承認待ち画面**
- **承認完了画面**
- **承認否認画面**
- **ログイン画面**
- **パスワードリセット画面**

#### 3.1.2 メインアプリ（アプリ参加後）
- **タイムライン画面**（ホーム）
- **投稿作成画面**
- **投稿詳細画面**
- **プロフィール画面**
- **感謝の木表示画面**
- **通知画面**
- **設定画面**
- **ブロックリスト画面**
- **ヘルプ・サポート画面**

#### 3.1.3 管理機能（管理者用）
- **管理者ログイン画面**
- **管理者ダッシュボード**
- **申請管理画面**（一覧、詳細、審査実行）
- **違反報告管理画面**（一覧、詳細、対応アクション）
- **コンテンツ管理画面**（検索、緊急対応、統計）
- **管理者権限管理画面**（ロール、ユーザー、監査ログ）

### 3.2 詳細画面遷移図

#### 3.2.1 初回利用・申請フロー

```
アプリ起動
    ↓
申請フォーム画面
    ↓（申請ボタン）
申請完了・承認待ち画面
    ↓（承認処理）
承認完了画面 ────→ ログイン画面
    ↓（ログインボタン）
タイムライン画面（ホーム）

※承認否認の場合：
承認否認画面
    ↓（再申請ボタン）
申請フォーム画面
```

#### 3.2.2 パスワードリセットフロー

```
ログイン画面
    ↓（「パスワードを忘れた場合」リンク）
パスワードリセット申請画面
    ↓（メールアドレス入力・送信ボタン）
[メールアドレス検証]
    ├─→ [有効] → メール送信完了画面
    └─→ [無効] → エラー表示・再入力
    ↓
メール送信完了画面
    ↓（メール内リンククリック）
[リンク検証]
    ├─→ [有効] → パスワード再設定画面
    └─→ [無効/期限切れ] → エラー画面
    ↓
パスワード再設定画面
    ↓（新パスワード入力・確認）
[パスワード検証]
    ├─→ [有効] → パスワード再設定完了画面
    └─→ [無効] → エラー表示・再入力
    ↓
パスワード再設定完了画面
    ↓（ログイン画面へボタン）
ログイン画面
```

#### 3.2.3 メインアプリ内の画面遷移

```
タイムライン画面（ホーム）
    ├─→ 投稿作成画面
    │    ├─→ AIレビュー・代替案提示画面
    │    └─→ 投稿完了・タイムライン画面
    ├─→ 投稿詳細画面
    │    ├─→ コメント作成・AIレビュー
    │    └─→ ポジティブ・リアクション
    ├─→ プロフィール画面
    │    ├─→ 感謝の木表示画面
    │    └─→ プロフィール編集画面
    ├─→ 通知画面
    │    └─→ 該当投稿詳細画面
    └─→ 設定画面
         ├─→ ブロックリスト画面
         ├─→ ヘルプ・サポート画面
         └─→ 退会画面
```

### 3.3 ナビゲーション構造

**下部タブバー（常時表示）**
- **ホーム**（タイムライン）
- **投稿**（投稿作成）
- **プロフィール**（マイページ）
- **通知**（通知一覧）
- **設定**（設定・その他）

---

## 4. 管理者機能の画面遷移 (Phase 5以降)

#### 4.1 管理者ログインフロー

```
管理者ログイン画面 (/admin/login)
    ↓（ID・パスワード入力・ログインボタン）
[1次認証検証]
    ├─→ [有効] → MFA認証画面
    └─→ [無効] → エラー表示・再入力
    ↓
MFA認証画面（TOTP/SMS）
    ↓（認証コード入力）
[MFA検証 + IPアドレスチェック]
    ├─→ [成功] → 管理者ダッシュボード
    ├─→ [認証エラー] → エラー表示・再入力
    └─→ [IP制限エラー] → アクセス拒否画面
```

#### 4.2 管理者ダッシュボードと主要機能への遷移

```
管理者ダッシュボード
    ├─→ 申請管理
    │    ├─→ 申請一覧画面
    │    │    ├─→ 申請詳細画面
    │    │    │    ├─→ 審査実行（承認/却下/保留）
    │    │    │    └─→ 審査履歴表示
    │    │    └─→ 申請一覧に戻る
    │    └─→ 審査統計・レポート画面
    │
    ├─→ 違反報告管理
    │    ├─→ 違反報告一覧画面
    │    │    ├─→ 違反報告詳細画面
    │    │    │    ├─→ 対応アクション実行画面
    │    │    │    │    ├─→ 警告/削除/停止実行
    │    │    │    │    └─→ 完了・報告一覧に戻る
    │    │    │    └─→ エスカレーション実行画面
    │    │    └─→ 報告一覧に戻る
    │    └─→ 違反統計・トレンド画面
    │
    ├─→ コンテンツ管理
    │    ├─→ コンテンツ検索・一覧画面
    │    │    ├─→ コンテンツ詳細・編集画面
    │    │    │    ├─→ 公開/非公開/削除操作
    │    │    │    └─→ 検索結果に戻る
    │    │    └─→ 検索結果更新
    │    ├─→ 緊急コンテンツ対応画面（アラートから直接遷移）
    │    │    ├─→ 緊急コンテンツ詳細画面
    │    │    │    ├─→ 即座削除/非表示操作
    │    │    │    └─→ 外部機関連携ガイド表示
    │    │    └─→ 緊急コンテンツ一覧に戻る
    │    └─→ コンテンツ統計・レポート画面
    │
    └─→ 管理者権限管理
         ├─→ ロール管理画面
         │    ├─→ ロール詳細・編集画面
         │    └─→ 権限設定・更新
         ├─→ 管理者ユーザー管理画面
         │    ├─→ 管理者ユーザー詳細・編集画面
         │    └─→ ロール割り当て・変更
         └─→ 監査ログ確認画面
              ├─→ ログ検索・フィルタリング
              └─→ ログ詳細表示・エクスポート
```

---

## 5. 特殊フロー (Phase 5以降)

### 5.1 エラーハンドリング・空の状態

```
各画面
    ↓（エラー発生）
[エラー種類判定]
    ├─→ [入力エラー] → インラインエラー表示
    ├─→ [ネットワークエラー] → トーストメッセージ表示
    ├─→ [サーバーエラー] → エラーダイアログ表示
    └─→ [致命的エラー] → 全画面エラー表示
    ↓（ユーザーアクション）
[復旧アクション]
    ├─→ [再試行] → 元の画面・処理
    ├─→ [修正] → 入力内容修正
    └─→ [キャンセル] → 前の画面

空の状態（データなし）
    ↓
[データ状態判定]
    ├─→ [初回利用] → オンボーディング表示
    ├─→ [データ未取得] → ローディング表示
    └─→ [データ不存在] → 空の状態UI表示
    ↓（ユーザーアクション）
[誘導アクション]
    ├─→ [投稿作成] → 投稿作成画面
    ├─→ [検索] → 検索画面
    └─→ [設定] → 設定画面
```

### 5.2 AIレビュー・コーチングフロー

```
投稿作成画面
    ↓（投稿ボタン）
AIレビュー中（ローディング）
    ↓
[問題なし] → 投稿完了
    ↓
[問題検知] → 代替案提示画面
    ├─→ 代替案選択 → 投稿完了
    ├─→ 自己修正 → 再AIレビュー
    └─→ キャンセル → 投稿作成画面
```

### 5.3 ポジティブ・リアクションフロー

```
投稿詳細画面 / タイムライン画面
    ↓（リアクションボタン）
リアクション選択
    ├─→ 感謝
    ├─→ 応援
    ├─→ 共感
    └─→ 素敵！
    ↓
リアクション完了
    ↓
通知送信（投稿者へ）
```

### 5.4 ゲーミフィケーション（感謝の木）

```
プロフィール画面
    ↓（感謝の木アイコン）
感謝の木表示画面
    ├─→ 成長記録確認
    ├─→ 統計情報確認
    └─→ 成長アニメーション再生
```

### 5.5 ポジティブ引用シェアフロー

```
投稿詳細画面 / タイムライン画面
    ↓（引用シェアボタン）
引用シェア作成画面
    ↓（引用コメント入力）
AIレビュー中（ローディング）
    ↓
[AIレビュー結果]
    ├─→ [問題なし] → 引用シェア投稿完了
    ├─→ [問題検知] → 代替案提示画面
    │    ├─→ 代替案選択 → 引用シェア投稿完了
    │    ├─→ 自己修正 → 再AIレビュー
    │    └─→ キャンセル → 引用シェア作成画面
    └─→ [キャンセル] → 投稿詳細画面
    ↓
引用シェア完了
    ↓
タイムライン画面（新しい引用投稿表示）
```

### 5.6 通報機能フロー

```
投稿詳細画面 / タイムライン画面
    ↓（...メニューアイコン）
メニュー表示
    ↓（通報選択）
通報理由選択画面
    ↓（理由選択・詳細入力）
[通報内容確認]
    ├─→ [送信] → 通報完了画面
    └─→ [キャンセル] → 投稿詳細画面
    ↓
通報完了画面
    ↓（ホームに戻る）
タイムライン画面

※ブロック選択の場合：
メニュー表示
    ↓（ブロック選択）
ブロック確認ダイアログ
    ├─→ [ブロック] → ブロック完了
    └─→ [キャンセル] → 投稿詳細画面
```

### 5.7 管理者機能の特別フロー

#### 5.7.1 緊急コンテンツ対応フロー

```
[システムアラート発生]（AI検知または緊急報告）
    ↓
緊急アラート通知（メール/SMS/Slack）
    ↓
管理者の緊急ログイン（短縮認証）
    ↓
緊急コンテンツ一覧画面（優先表示）
    ↓（コンテンツ選択）
緊急コンテンツ詳細画面
    ├─→ 即座削除/非表示実行
    ├─→ 外部機関連携ガイド表示（警察、相談窓口等）
    └─→ ユーザーへの緊急サポートメッセージ送信
    ↓
対応完了・結果記録画面
    ↓
管理者ダッシュボードに戻る
```

#### 5.7.2 管理者セッション管理フロー

```
管理者セッション中
    ↓（30分非アクティブ）
タイムアウト警告ポップアップ
    ├─→ [継続] → セッション延長
    └─→ [ログアウト] → 管理者ログイン画面

高権限操作実行時（ユーザーBAN、システム設定変更等）
    ↓
再認証プロンプト表示
    ↓（パスワード再入力）
[再認証検証]
    ├─→ [成功] → 高権限操作継続
    └─→ [失敗] → 操作キャンセル・エラー表示
```

---

## 6. 画面遷移における重要な考慮事項

### 6.1 ユーザー体験の維持
- **スムーズで優しい遷移:** 急激な画面切り替えを避け、滑らかなアニメーションを採用
- **非侵襲的なフィードバック:** AIレビュー結果は、ユーザーの思考を阻害しない形で提示
- **ポジティブな文言:** すべてのメッセージで「寄り添うコーチ役」の姿勢を維持

### 6.2 機能の発見しやすさ
- **明確なナビゲーション:** 主要機能はタブバーで常にアクセス可能
- **適切なパンくずリスト:** 深い階層でも現在位置を把握できるよう配慮
- **検索機能:** 今後実装予定の機能への導線を考慮

### 6.3 エラーハンドリング
- **丁寧なエラーメッセージ:** 技術的なエラーも、ユーザーフレンドリーな表現で提示
- **復旧への導線:** エラー発生時も、適切な次のアクションを提示
- **通信エラー対応:** オフライン時やサーバーエラー時の適切な表示

### 6.4 管理者機能の特別考慮事項 (Phase 5以降)

#### 6.4.1 セキュリティ強化
- **分離されたアクセス経路:** 一般ユーザーとは完全に分離された管理者専用URLとログインフロー
- **多層認証:** ID・パスワード + MFA + IP制限の組み合わせ
- **セッション管理:** 30分の非アクティブタイムアウト、高権限操作時の再認証

#### 6.4.2 オペレーション効率化
- **緊急アラート対応:** システムからの緊急アラートに対する迅速アクセスと対応フロー
- **一括操作:** 複数のコンテンツやユーザーに対する一括操作機能
- **コンテキスト情報:** 違反報告やコンテンツ管理時の充実したコンテキスト情報表示

#### 6.4.3 監査と透明性
- **全操作ログ:** 管理者のすべての操作を詳細に記録し、監査可能な状態を維持
- **権限制御:** 管理者ロールに応じた細かい権限制御とアクセス管理
- **変更履歴:** 設定変更、ユーザー情報変更などの履歴を明確に追跡

---

## 7. 今後の拡張性

### 7.1 機能追加への対応
- **Could機能の追加:** 画像・動画投稿、検索機能等の追加時の遷移パスを考慮
- **新しいポジティブ機能:** 今後追加される可能性のある機能への拡張性を維持

### 7.2 プラットフォーム対応
- **レスポンシブデザイン:** PC、タブレット、スマートフォンでの適切な表示
- **アプリ化:** 今後のネイティブアプリ化時の遷移パターンを考慮

---

## 8. 承認

**承認者欄:**
- プロダクトオーナー: ________________  
- 開発責任者: ________________  
- UI/UXデザイナー: ________________
- セキュリティ担当: ________________  

**承認日:** 20xx年xx月xx日

---

*本文書は、開発プロジェクトの進行に伴い更新される場合があります。*